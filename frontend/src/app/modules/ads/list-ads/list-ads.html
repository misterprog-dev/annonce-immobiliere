<p-toast></p-toast>
<div class="container-fluid mt-5 list-ad">
	<div class="row">
		<div class="col-10 datagrid">
			<p-table #annonceDG
					 [value]="annonces"
					 loadingIcon="app-spinner"
					 [paginator]="true"
					 [rows]="20"
					 [loading]="loading"
					 [(selection)]="annoncesSelectionnes"
					 [scrollable]="true"
					 scrollHeight="620px"
					 [resetPageOnSort]="false"
					 (onFilter)="onFilterTable($event?.filteredValue)"
					 selectionMode="multiple"
					 dataKey="id"
					 sortField="title">
				<ng-template pTemplate="colgroup">
					<colgroup>
						<col style="width: 3%"><!-- checkbox -->
						<col style="width: 25%"><!-- Image -->
						<col style="width: 20%"><!-- Title -->
						<col style="width: 42%"><!-- Description -->
						<col style="width: 10%"><!-- Actions -->
					</colgroup>
				</ng-template>
				<ng-template pTemplate="header">
					<tr>
						<th>
							<p-tableHeaderCheckbox></p-tableHeaderCheckbox>
						</th>
						<th class="text-center">
							Image
						</th>
						<th class="text-center" pSortableColumn="title">
							Titre
							<p-sortIcon field="title"></p-sortIcon>
						</th>
						<th class="text-center" pSortableColumn="description">
							Description
							<p-sortIcon field="description"></p-sortIcon>
						</th>
						<th class="text-center">
							Action
						</th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-annonce>
					<tr [pSelectableRow]="annonce">
						<ng-container>
							<td class="text-center">
								<p-tableCheckbox [value]="annonce" (click)="$event.stopPropagation()"></p-tableCheckbox>
							</td>
							<td style="text-align: center">
								<img *ngIf="!!annonce.fileName"
									 src="{{ './assets/upload/' + annonce.id + '/' + annonce.fileName }}"
									 alt="{{ annonce.fileName }}"
									 height="80px"
									 width="100"/></td>
							<td class="text-left">{{ annonce.title }}</td>
							<td class="text-left">{{ annonce.description }}</td>
							<td class="col-actions">
								<p-button icon="pi pi-pencil"
										  title="Modifier"
										  (click)="openEditingModal(annonce)"></p-button>
								<p-button icon="pi pi-times"
										  class="ml"
										  title="Supprimer"
										  (click)="openDeletingModal(annonce)"></p-button>
							</td>
						</ng-container>
					</tr>
				</ng-template>
				<ng-template pTemplate="emptymessage">
					<tr>
						<td colspan="10" style="text-align: center;" translate>Aucune annonce</td>
					</tr>
				</ng-template>
			</p-table>
		</div>
	</div>
	<div class="footer">
		<p-button label="CrÃ©er une annonce"
				  (click)="openEditingModal()"></p-button>
		<p-button label="Modifier une annonce"
				  icon="pi pi-pencil"
				  (click)="openEditingModal(annoncesSelectionnes[0])"
				  [disabled]="!annoncesSelectionnes || annoncesSelectionnes.length !== 1">
		</p-button>
		<p-button label="Supprimer une annonce"
				  icon="pi pi-times"
				  (click)="openDeletingModal(annoncesSelectionnes[0])"
				  [disabled]="!annoncesSelectionnes || annoncesSelectionnes.length !== 1">
		</p-button>
	</div>
</div>

<!-- We call our modal here -->
<edit-ad-modal [(visible)]="editingVisible"
			   [annonce]="annonceSelectionne"
			   (annonceChange)="onAdsChanged()"></edit-ad-modal>
<delete-ad-modal [(visible)]="deleteVisible"
			   [annonce]="annonceSelectionne"
			   (annonceChange)="onAdsChanged()"></delete-ad-modal>
